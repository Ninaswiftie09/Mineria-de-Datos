---
title: "Laboratorio 1"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document:
    latex_engine: xelatex
header-includes:
  - \usepackage{float}
  - \usepackage[margin=1in]{geometry}
---

## Integrantes
- Nina Nájera - 231088  
- Mishell Ciprian - 231169  
- Diego Ramirez - 23601  

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)

library(tidyverse)
library(knitr)
library(lubridate)
library(scales)
library(stringr)
library(purrr)

if (!requireNamespace("nortest", quietly = TRUE)) install.packages("nortest")
library(nortest)

movies <- read.csv("movies_2026.csv", stringsAsFactors = FALSE, fileEncoding = "UTF-8")

# Arreglar posibles caracteres raros (evita errores de UTF-8 al imprimir tablas)
movies <- movies %>%
  mutate(across(where(is.character), ~ iconv(.x, from = "", to = "UTF-8", sub = "")))

movies <- movies %>%
  mutate(
    genres = na_if(str_trim(genres), ""),
    productionCountry = na_if(str_trim(productionCountry), ""),
    productionCompanyCountry = na_if(str_trim(productionCompanyCountry), ""),
    homePage = na_if(str_trim(homePage), ""),
    actorsPopularity = na_if(str_trim(actorsPopularity), ""),
    releaseDate = na_if(str_trim(releaseDate), "")
  ) %>%
  mutate(
    releaseDate = suppressWarnings(as.Date(releaseDate)),
    releaseYear = if_else(!is.na(releaseDate), year(releaseDate), as.integer(releaseYear)),
    releaseMonth = if_else(!is.na(releaseDate), month(releaseDate, label = TRUE, abbr = TRUE), NA)
  ) %>%
  mutate(
    main_genre = map_chr(str_split(genres %||% "", "\\|"), ~ ifelse(length(.x) >= 1 && .x[1] != "", .x[1], NA_character_)),
    productionCountry_main = map_chr(str_split(productionCountry %||% "", "\\|"), ~ ifelse(length(.x) >= 1 && .x[1] != "", .x[1], NA_character_))
  )
```
### Recomendación.
  Recomendamos que corran el archivo en html ya que en PDF por algún motivo que aún desconocemos porque algunas tablas o gráficos se están corriendo a la derecha, pero en html no pasa eso. 

### Link del repositorio: 
  https://github.com/Ninaswiftie09/Mineria-de-Datos 

## Ejercicio 1

> **Enunciado:** Haga una exploración rápida de sus datos (resumen del conjunto de datos).

```{r ejercicio1_resumen}
dim(movies)
names(movies)
dplyr::glimpse(movies)
summary(movies)

na_by_col <- sort(colSums(is.na(movies)), decreasing = TRUE)
na_by_col[1:15]
```

**Comentario:**  
Con esto vemos rápido: el tamaño del dataset, las columnas que existen, el tipo de datos, valores típicos y cuáles variables tienen más datos faltantes (NA).

---

## Ejercicio 2

### Tipos de variables (según su naturaleza)

- **id**: Identificador (no se analiza como variable)
- **popularity**: Cuantitativa continua  
- **budget**: Cuantitativa continua  
- **revenue**: Cuantitativa continua  
- **originalTitle**: Cualitativa nominal  
- **originalLanguage**: Cualitativa nominal  
- **title**: Cualitativa nominal  
- **homePage**: Cualitativa nominal (sí/no, según exista)  
- **video**: Cualitativa nominal dicotómica  
- **director**: Cualitativa nominal  
- **runtime**: Cuantitativa continua  
- **genres**: Cualitativa nominal (texto, a veces combinada)  
- **genresAmount**: Cuantitativa discreta  
- **productionCompany**: Cualitativa nominal  
- **productionCoAmount**: Cuantitativa discreta  
- **productionCompanyCountry**: Cualitativa nominal  
- **productionCountry**: Cualitativa nominal  
- **productionCountriesAmount**: Cuantitativa discreta  
- **releaseDate**: Variable temporal (fecha)  
- **voteCount**: Cuantitativa discreta  
- **voteAvg**: Cuantitativa continua  
- **actors**: Cualitativa nominal  
- **actorsPopularity**: Cuantitativa continua (lista por actor)  
- **actorsCharacter**: Cualitativa nominal  
- **actorsAmount**: Cuantitativa discreta  
- **castWomenAmount**: Cuantitativa discreta  
- **castMenAmount**: Cuantitativa discreta  
- **releaseYear**: Cuantitativa discreta (año)

---

## Ejercicio 3

### 3.1 Variables cuantitativas

```{r}
quant_vars <- movies %>%
  select(
    popularity, budget, revenue, runtime, voteAvg, voteCount,
    actorsAmount, castWomenAmount, castMenAmount
  )
```

#### Histogramas (vista general)

```{r fig.width=8.5, fig.height=6, fig.align='center', out.width="0.98\\linewidth"}
quant_vars %>%
  pivot_longer(cols = everything()) %>%
  ggplot(aes(x = value)) +
  geom_histogram(bins = 30) +
  facet_wrap(~name, scales = "free", ncol = 3) +
  theme_minimal(base_size = 10) +
  theme(
    strip.text = element_text(size = 9),
    plot.margin = margin(6, 6, 6, 6)
  )
```

**Explicación:**  
Los histogramas ayudan a ver cómo se distribuye cada variable (si está muy cargada a un lado, si hay valores extremos, etc.).

#### Histogramas en escala log (solo para variables muy grandes)

```{r}
quant_log <- quant_vars %>%
  mutate(
    budget = ifelse(budget <= 0, NA, budget),
    revenue = ifelse(revenue <= 0, NA, revenue),
    voteCount = ifelse(voteCount <= 0, NA, voteCount)
  ) %>%
  select(budget, revenue, voteCount) %>%
  pivot_longer(everything()) %>%
  filter(!is.na(value))

ggplot(quant_log, aes(x = log10(value))) +
  geom_histogram(bins = 30) +
  facet_wrap(~name, scales = "free", ncol = 3) +
  theme_minimal() +
  labs(x = "log10(valor)")
```

**Explicación:**  
Como presupuesto/ingresos/votos tienen valores enormes, la escala log nos deja ver mejor el patrón sin que todo se aplaste por unos pocos valores muy altos.

#### Prueba de normalidad (Lilliefors)

```{r}
lillie_results <- sapply(quant_vars, function(x) {
  x <- na.omit(x)
  nortest::lillie.test(x)$p.value
})

lillie_tbl <- tibble(
  variable = names(lillie_results),
  p_value = as.numeric(lillie_results),
  normalidad = if_else(p_value < 0.05, "No normal", "No se rechaza normalidad")
) %>% arrange(p_value)

kable(lillie_tbl, digits = 6, caption = "Prueba de normalidad de Lilliefors por variable")
```

**Conclusión:**  
Si el **p-value < 0.05**, se rechaza la normalidad. En este dataset, la mayoría de variables cuantitativas dan p-values muy pequeños, así que **no siguen una distribución normal**.

---

### 3.2 Variables cualitativas

> Nota: Para no hacer el reporte eterno, se muestra **Top 10 + Otros** cuando hay muchas categorías.

```{r}
top_n <- 10
```

#### Tablas de frecuencia

**Idioma original (originalLanguage)**

```{r}
freq_language <- movies %>%
  count(originalLanguage, sort = TRUE) %>%
  mutate(percentage = n / sum(n) * 100)

kable(
  head(freq_language, top_n),
  col.names = c("Idioma original", "Frecuencia", "Porcentaje (%)"),
  digits = 2,
  caption = paste0("Top ", top_n, " idiomas originales")
)
```

**Explicación:**  
Aquí se observa qué idiomas aparecen más en el dataset. Generalmente pocos idiomas dominan y los demás son menos frecuentes.

**Género principal (main_genre) – Top 10 + Otros**

```{r}
freq_main_genre <- movies %>%
  filter(!is.na(main_genre)) %>%
  count(main_genre, sort = TRUE) %>%
  mutate(grupo = if_else(row_number() <= top_n, main_genre, "Otros")) %>%
  group_by(grupo) %>%
  summarise(n = sum(n), .groups = "drop") %>%
  mutate(percentage = n / sum(n) * 100) %>%
  arrange(desc(n))

kable(
  freq_main_genre,
  col.names = c("Género principal", "Frecuencia", "Porcentaje (%)"),
  digits = 2,
  caption = paste0("Frecuencia de géneros principales (Top ", top_n, " + Otros)")
)
```

**Explicación:**  
Se usa el **género principal** (el primero) para resumir mejor. Normalmente pocos géneros concentran gran parte de las películas.

**Videos promocionales (video)**

```{r}
freq_video <- movies %>%
  mutate(video_cat = case_when(
    is.na(video) ~ "Desconocido",
    video %in% c(TRUE, "TRUE", "True", 1, "1") ~ "Sí",
    video %in% c(FALSE, "FALSE", "False", 0, "0") ~ "No",
    TRUE ~ as.character(video)
  )) %>%
  count(video_cat, sort = TRUE) %>%
  mutate(percentage = n / sum(n) * 100)

kable(
  freq_video,
  col.names = c("Video promocional", "Frecuencia", "Porcentaje (%)"),
  digits = 2,
  caption = "Tabla de frecuencias de videos promocionales"
)
```

**Explicación:**  
Se separa “Desconocido” cuando falta el dato, para no mezclarlo con un “No”.

**País de producción (productionCountry_main) – Top 10 + Otros**

```{r}
freq_prod_country <- movies %>%
  filter(!is.na(productionCountry_main)) %>%
  count(productionCountry_main, sort = TRUE) %>%
  mutate(grupo = if_else(row_number() <= top_n, productionCountry_main, "Otros")) %>%
  group_by(grupo) %>%
  summarise(n = sum(n), .groups = "drop") %>%
  mutate(percentage = n / sum(n) * 100) %>%
  arrange(desc(n))

kable(
  freq_prod_country,
  col.names = c("País de producción", "Frecuencia", "Porcentaje (%)"),
  digits = 2,
  caption = paste0("Frecuencia de países de producción (Top ", top_n, " + Otros)")
)
```

**Conclusión:**  
En general, las cualitativas no se reparten parejo: hay categorías que dominan y luego una “cola” larga de categorías raras. Por eso Top 10 + Otros es una forma práctica de resumir.

---
## Ejercicio 4
### 4.1 ¿Cuáles son las 10 películas con mayor presupuesto?

```{r}
top_budget <- movies %>%
  filter(budget > 0, !is.na(title)) %>%
  arrange(desc(budget)) %>%
  select(title, budget) %>%
  slice(1:10)

kable(top_budget, caption = "Top 10 películas con mayor presupuesto")
```

**Explicación:**  
Estas son las películas con presupuestos más altos. Normalmente son películas grandes (blockbusters) por efectos, marketing y producción.

### 4.2 ¿Cuáles son las 10 películas con mayores ingresos?

```{r}
top_revenue <- movies %>%
  filter(revenue > 0, !is.na(title)) %>%
  arrange(desc(revenue)) %>%
  select(title, revenue) %>%
  slice(1:10)

kable(top_revenue, caption = "Top 10 películas con mayores ingresos")
```

**Explicación:**  
Aquí se ve qué películas fueron las más taquilleras (ingresos más altos).

### 4.3 ¿Cuál es la película con más votos?

```{r}
most_votes <- movies %>%
  arrange(desc(voteCount)) %>%
  select(title, voteCount) %>%
  slice(1)

kable(most_votes, caption = "Película con mayor cantidad de votos")
```

**Explicación:**  
Es la película con más gente votando, o sea, la más “popular” en participación.

### 4.4 ¿Cuál es la peor película según los votos?

```{r}
worst_movie <- movies %>%
  filter(voteCount > 50) %>%
  arrange(voteAvg) %>%
  select(title, voteAvg, voteCount) %>%
  slice(1)

kable(worst_movie, caption = "Peor película (con al menos 50 votos)")
```

**Explicación:**  
Se filtra por mínimo de votos para que no gane una película con 1 voto. Luego se toma la de menor promedio.

### 4.5 ¿Cuántas películas se hicieron por año?

```{r}
movies_per_year <- movies %>%
  filter(!is.na(releaseYear)) %>%
  count(releaseYear, name = "total") %>%
  arrange(releaseYear)

ggplot(movies_per_year, aes(x = releaseYear, y = total)) +
  geom_col() +
  labs(
    title = "Cantidad de películas por año",
    x = "Año de lanzamiento",
    y = "Cantidad de películas"
  ) +
  theme_minimal()

kable(movies_per_year %>% arrange(desc(total)) %>% slice(1), caption = "Año con más películas en el dataset")
```

**Explicación:**  
El gráfico muestra cuántas películas aparecen por año. Si algún año tiene un pico, puede ser porque el dataset tiene más registros de ese periodo.

### 4.6 Géneros principales y duración

**Género que predomina en todo el dataset (género principal)**

```{r}
genre_count <- movies %>%
  filter(!is.na(main_genre)) %>%
  count(main_genre, sort = TRUE)

ggplot(genre_count[1:10,], aes(x = reorder(main_genre, n), y = n)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Géneros principales más frecuentes",
    x = "Género principal",
    y = "Cantidad de películas"
  ) +
  theme_minimal()
```

**Explicación:**  
Acá se ven los géneros principales más comunes. Esto ayuda a entender qué tipo de películas dominan la muestra.

**Género de las películas más largas**

```{r}
longest_movies <- movies %>%
  filter(!is.na(runtime)) %>%
  arrange(desc(runtime)) %>%
  select(title, main_genre, runtime) %>%
  slice(1:10)

kable(longest_movies, caption = "Top 10 películas más largas")
```

**Explicación:**  
Sirve para ver si cierto tipo de película tiende a durar más.

### 4.7 ¿Qué género obtuvo mayores ganancias?

```{r}
revenue_by_genre <- movies %>%
  filter(revenue > 0, !is.na(main_genre)) %>%
  group_by(main_genre) %>%
  summarise(
    total_revenue = sum(revenue, na.rm = TRUE),
    avg_revenue = mean(revenue, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) %>%
  arrange(desc(total_revenue))

kable(head(revenue_by_genre, 10), caption = "Top 10 géneros principales por ingresos totales")
```

```{r}
ggplot(head(revenue_by_genre, 10), aes(x = reorder(main_genre, total_revenue), y = total_revenue)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = dollar) +
  theme_minimal() +
  labs(title = "Top 10 géneros por ingresos totales", x = "Género principal", y = "Ingresos totales")
```

**Explicación:**  
Se usa la suma de ingresos por género principal para ver cuáles géneros acumulan más taquilla.

### 4.8 ¿La cantidad de actores influye en los ingresos? ¿Se han hecho películas con más actores en los últimos años?

```{r}
ggplot(movies %>% filter(revenue > 0), aes(x = actorsAmount, y = revenue)) +
  geom_point(alpha = 0.4) +
  scale_y_continuous(labels = dollar) +
  labs(
    title = "Cantidad de actores vs ingresos",
    x = "Cantidad de actores",
    y = "Ingresos"
  ) +
  theme_minimal()

cor_actors_revenue <- cor(movies$actorsAmount, movies$revenue, use = "complete.obs")
cor_actors_revenue
```

**Explicación:**  
El scatter muestra si al subir actores suben ingresos. La correlación resume la relación: cerca de 0 significa relación débil.

```{r}
actors_trend <- movies %>%
  filter(!is.na(releaseYear), actorsAmount > 0, actorsAmount < 200) %>%
  group_by(releaseYear) %>%
  summarise(avg_actors = mean(actorsAmount, na.rm = TRUE), .groups = "drop")

ggplot(actors_trend, aes(x = releaseYear, y = avg_actors)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  labs(title = "Actores promedio por año", x = "Año", y = "Actores promedio")
```

**Explicación:**  
Este gráfico responde si con los años se ve tendencia a elencos más grandes (promedio de actores por año).

### 4.9 Influencia de género del elenco en popularidad e ingresos

```{r}
gender_df <- movies %>%
  mutate(
    total_cast = castWomenAmount + castMenAmount,
    women_ratio = if_else(total_cast > 0, castWomenAmount / total_cast, NA_real_)
  ) %>%
  filter(!is.na(women_ratio))

kable(
  tibble(
    cor_women_popularity = cor(gender_df$women_ratio, gender_df$popularity, use = "complete.obs"),
    cor_women_revenue = cor(gender_df$women_ratio, gender_df$revenue, use = "complete.obs")
  ),
  caption = "Correlación de proporción de mujeres con popularidad e ingresos"
)
```

```{r}
ggplot(gender_df, aes(x = women_ratio, y = popularity)) +
  geom_point(alpha = 0.3) +
  theme_minimal() +
  labs(title = "Proporción de mujeres vs popularidad", x = "women_ratio", y = "popularity")

ggplot(gender_df %>% filter(revenue > 0), aes(x = women_ratio, y = revenue)) +
  geom_point(alpha = 0.3) +
  scale_y_continuous(labels = dollar) +
  theme_minimal() +
  labs(title = "Proporción de mujeres vs ingresos", x = "women_ratio", y = "revenue")
```

**Explicación:**  
Se analiza si cambia popularidad o ingresos según la proporción de mujeres en el elenco. Si la nube no tiene tendencia clara y la correlación es baja, la relación es débil.

### 4.10 ¿Quiénes son los directores de las 20 películas mejor calificadas?

```{r}
top_rated_movies <- movies %>%
  filter(voteCount > 100) %>%
  arrange(desc(voteAvg)) %>%
  select(title, director, voteAvg, voteCount) %>%
  slice(1:20)

kable(top_rated_movies, caption = "Top 20 películas mejor calificadas (con >100 votos)")
```

```{r}
top_directors <- top_rated_movies %>%
  count(director, sort = TRUE)

kable(top_directors, caption = "Directores que aparecen en el Top 20")
```

**Explicación:**  
El filtro de votos evita casos raros. Luego se ve qué directores se repiten en las mejores.

### 4.11 ¿Cómo se correlacionan los presupuestos con los ingresos?

```{r}
ggplot(movies %>% filter(budget > 0), aes(x = budget)) +
  geom_histogram(bins = 50) +
  scale_x_continuous(labels = dollar) +
  labs(
    title = "Distribución de presupuestos",
    x = "Presupuesto",
    y = "Frecuencia"
  ) +
  theme_minimal()

ggplot(movies %>% filter(budget > 0, revenue > 0), aes(x = budget, y = revenue)) +
  geom_point(alpha = 0.4) +
  scale_x_continuous(labels = dollar) +
  scale_y_continuous(labels = dollar) +
  labs(
    title = "Presupuesto vs Ingresos",
    x = "Presupuesto",
    y = "Ingresos"
  ) +
  theme_minimal()

cor_budget_revenue <- cor(movies$budget, movies$revenue, use = "complete.obs")
cor_budget_revenue
```

**Explicación:**  
Se ve una relación positiva: en general, más presupuesto suele asociarse con más ingresos. Igual, no significa que “más presupuesto = éxito garantizado”.

### 4.12 ¿Se asocian ciertos meses de lanzamiento con mejores ingresos?

```{r}
revenue_by_month <- movies %>%
  filter(revenue > 0, !is.na(releaseMonth)) %>%
  group_by(releaseMonth) %>%
  summarise(avg_revenue = mean(revenue, na.rm = TRUE), .groups = "drop")

ggplot(revenue_by_month, aes(x = releaseMonth, y = avg_revenue)) +
  geom_col() +
  scale_y_continuous(labels = dollar) +
  labs(
    title = "Ingresos promedio por mes de lanzamiento",
    x = "Mes",
    y = "Ingresos promedio"
  ) +
  theme_minimal()
```

**Explicación:**  
Esto muestra si hay meses donde, en promedio, las películas ganan más.

### 4.13 ¿En qué meses se lanzan más películas y cuántas en promedio?

```{r}
movies_per_month <- movies %>%
  filter(!is.na(releaseMonth)) %>%
  group_by(releaseMonth) %>%
  summarise(total_movies = n(), .groups = "drop")

ggplot(movies_per_month, aes(x = releaseMonth, y = total_movies)) +
  geom_col() +
  labs(
    title = "Cantidad de películas lanzadas por mes",
    x = "Mes",
    y = "Cantidad de películas"
  ) +
  theme_minimal()

mean(movies_per_month$total_movies)
```

**Explicación:**  
El gráfico indica en qué meses se estrena más. El promedio ayuda a comparar si un mes está por arriba o por debajo de lo normal.

### 4.14 ¿Cómo se correlacionan las calificaciones con el éxito comercial?

```{r}
ggplot(movies %>% filter(revenue > 0), aes(x = voteAvg, y = revenue)) +
  geom_point(alpha = 0.4) +
  scale_y_continuous(labels = dollar) +
  labs(
    title = "Calificación promedio vs Ingresos",
    x = "Calificación promedio",
    y = "Ingresos"
  ) +
  theme_minimal()

cor_voteavg_revenue <- cor(movies$voteAvg, movies$revenue, use = "complete.obs")
cor_voteavg_revenue
```

**Explicación:**  
Si la correlación es baja, significa que una mejor calificación no siempre se traduce en más ingresos (y viceversa).

### 4.15 ¿La popularidad del elenco se correlaciona con el éxito de taquilla?

```{r}
movies <- movies %>%
  mutate(
    actorsPopularity_avg = map_dbl(actorsPopularity, \(x){
      if (is.na(x) || str_trim(x) == "") return(NA_real_)
      vals <- suppressWarnings(as.numeric(str_split(x, "\\|")[[1]]))
      if (all(is.na(vals))) NA_real_ else mean(vals, na.rm = TRUE)
    })
  )

ggplot(movies %>% filter(revenue > 0, !is.na(actorsPopularity_avg)),
       aes(x = actorsPopularity_avg, y = revenue)) +
  geom_point(alpha = 0.4) +
  scale_y_continuous(labels = dollar) +
  labs(
    title = "Popularidad promedio del elenco vs Ingresos",
    x = "Popularidad promedio del elenco",
    y = "Ingresos"
  ) +
  theme_minimal()

cor_castpop_revenue <- cor(movies$actorsPopularity_avg, movies$revenue, use = "complete.obs")
cor_castpop_revenue
```

**Explicación:**  
Esto revisa si elencos más “populares” se asocian con más taquilla. Si la correlación es baja, la relación no es fuerte.

### 4.16 ¿Qué estrategias de marketing generan mejores resultados?

```{r}
marketing_video <- movies %>%
  mutate(video_cat = case_when(
    is.na(video) ~ "Desconocido",
    video %in% c(TRUE, "TRUE", "True", 1, "1") ~ "Sí",
    video %in% c(FALSE, "FALSE", "False", 0, "0") ~ "No",
    TRUE ~ as.character(video)
  )) %>%
  group_by(video_cat) %>%
  summarise(
    avg_revenue = mean(revenue, na.rm = TRUE),
    avg_popularity = mean(popularity, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  )

kable(marketing_video, digits = 2, caption = "Promedios según video promocional")
```

```{r}
marketing_homepage <- movies %>%
  mutate(has_homepage = if_else(is.na(homePage), "No", "Sí")) %>%
  group_by(has_homepage) %>%
  summarise(
    avg_revenue = mean(revenue, na.rm = TRUE),
    avg_popularity = mean(popularity, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  )

kable(marketing_homepage, digits = 2, caption = "Promedios según si tiene homepage")
```

**Explicación:**  
Comparando promedios, se puede ver si tener video promocional o homepage se asocia con mayor popularidad e ingresos. Si hay mucha diferencia, puede sugerir que ayuda (aunque no prueba causalidad).

---
## Ejercicio 5 (Puntos extra)

> 6 preguntas nuevas propuestas para explorar el dataset (y ganar puntos extra).

### 5.1 ¿Qué idiomas tienen mayor ingreso promedio?

```{r}
rev_by_lang <- movies %>%
  filter(revenue > 0, !is.na(originalLanguage)) %>%
  group_by(originalLanguage) %>%
  summarise(avg_revenue = mean(revenue, na.rm = TRUE), n = n(), .groups = "drop") %>%
  filter(n >= 20) %>%
  arrange(desc(avg_revenue))

kable(head(rev_by_lang, 10), caption = "Top 10 idiomas por ingreso promedio (n>=20)") 
```

**Explicación:**  
Se filtra por n>=20 para que no gane un idioma con muy pocas películas.

### 5.2 ¿Más géneros (genresAmount) se asocia con más ingresos?

```{r}
ggplot(movies %>% filter(revenue > 0, genresAmount > 0), aes(x = genresAmount, y = revenue)) +
  geom_point(alpha = 0.35) +
  scale_y_continuous(labels = dollar) +
  theme_minimal() +
  labs(title = "Cantidad de géneros vs ingresos", x = "Cantidad de géneros", y = "Ingresos")

cor(movies$genresAmount, movies$revenue, use = "complete.obs")
```

**Explicación:**  
Esto sirve para ver si películas “más mezcladas” en géneros tienden a generar más taquilla.

### 5.3 ¿Qué tan común es tener homepage por año?

```{r}
homepage_by_year <- movies %>%
  filter(!is.na(releaseYear)) %>%
  mutate(has_homepage = !is.na(homePage)) %>%
  group_by(releaseYear) %>%
  summarise(pct_homepage = mean(has_homepage, na.rm = TRUE) * 100, .groups = "drop")

ggplot(homepage_by_year, aes(x = releaseYear, y = pct_homepage)) +
  geom_line() + geom_point() +
  theme_minimal() +
  labs(title = "Porcentaje de películas con homepage por año", x = "Año", y = "% con homepage")
```

**Explicación:**  
Muestra si con el tiempo se vuelve más común que una película tenga página oficial registrada.

### 5.4 ¿Cómo cambia la popularidad promedio por año?

```{r}
pop_by_year <- movies %>%
  filter(!is.na(releaseYear), !is.na(popularity)) %>%
  group_by(releaseYear) %>%
  summarise(avg_popularity = mean(popularity, na.rm = TRUE), .groups = "drop")

ggplot(pop_by_year, aes(x = releaseYear, y = avg_popularity)) +
  geom_line() + geom_point() +
  theme_minimal() +
  labs(title = "Popularidad promedio por año", x = "Año", y = "Popularidad promedio")
```

**Explicación:**  
Sirve para ver si el dataset refleja años con películas más “populares” en promedio.

### 5.5 ¿Runtime se relaciona con voteAvg?

```{r}
ggplot(movies %>% filter(!is.na(runtime), !is.na(voteAvg)),
       aes(x = runtime, y = voteAvg)) +
  geom_point(alpha = 0.35) +
  theme_minimal() +
  labs(title = "Duración vs calificación promedio", x = "Duración (min)", y = "voteAvg")

cor(movies$runtime, movies$voteAvg, use = "complete.obs")
```

**Explicación:**  
Ayuda a ver si películas más largas tienden a ser mejor o peor calificadas.

### 5.6 ¿Qué países tienen mejor calificación promedio?

```{r}
rating_by_country <- movies %>%
  filter(!is.na(productionCountry_main), voteCount > 100) %>%
  group_by(productionCountry_main) %>%
  summarise(avg_vote = mean(voteAvg, na.rm = TRUE), n = n(), .groups = "drop") %>%
  filter(n >= 20) %>%
  arrange(desc(avg_vote))

kable(head(rating_by_country, 10), caption = "Top 10 países por calificación promedio (n>=20, voteCount>100)")
```

**Explicación:**  
Se filtra por cantidad mínima de películas y votos para que sea más justo el ranking.

